# 地图与表格联动交互设计

## 一、视图布局

### 1.1 基础结构

- 视图采用**上下布局**：Map（地图）+ Table（表格）
- 布局容器使用 Flex 布局，支持自适应屏幕尺寸

### 1.2 初始化逻辑

- 项目初始化时：
  - 预加载表格list，带 经纬度字段。表格分页，每页显示 1000 条。
  - 检测设备网络状态，存入全局状态管理
  - 记录用户上次的布局偏好（localStorage）

### 1.3 网络状态适配

| 网络状态 | Map 显示 | Table 显示 | 切换入口 |
|---------|---------|-----------|----------|
| 有网络   | ✅ 显示  | ✅ 显示    | ✅ 可切换 |
| 无网络   | ❌ 隐藏  | ✅ 显示    | ❌ 不提供 |

---

## 二、拖拽交互（用户操作流畅性）

### 2.1 拖拽区域

- 在 Map 与 Table 之间设置**拖拽分隔条**（Divider）
- 分隔条高度：4px，hover 时高亮显示
- 鼠标样式：`cursor: row-resize`

### 2.2 拖拽行为

- 支持上下拖拽调整 Map/Table 高度比例
- 拖拽至边缘（≤ 2px）时自动隐藏该组件
- 隐藏后显示展开按钮，点击恢复 60:40 布局

---

## 三、地图与表格联动（界面响应便捷性）

### 3.1 Map → Table 联动

#### 点击地图点位时

1. **单个点位**：切换为 selected 状态 + 弹出 Info Popover + 表格联动

2. **聚合点**：放大地图层级至聚合展开

### 3.2 Table → Map 联动

#### 点击表格行时

1. **行高亮**：选中行高亮显示

2. **地图响应流程**

   ```
   判断目标点位是否在当前视口可见
         │
         ├── 可见 ──→ 平移地图，将点位居中（panTo 动画 300ms）
         │              │
         │              └── 显示 Info Window
         │
         └── 不可见 ──→ 缩小层级使 target 进入可视范围（边缘即可）
                               → 平移至 target 居中
                               → 放大至 target 非聚合状态
   ```

3. **层级调整**：放大至 target 非聚合状态（最大 18 级）

---

## 四、视觉呈现（美观性）

### 4.1 点位图标设计

| 状态 | 图标样式 | 大小 | 颜色 |
|-----|---------|------|------|
| 默认 | 圆形实心 | 12px | `#F56C6C` |
| Selected | 定位针 | 24px | `#409EFF` |

### 4.2 聚合点设计

#### 聚合规则

- 相同层级下，距离 < 60px 的点位进行聚合

#### 聚合图标分级

| 聚合数量 | 图标大小 | 背景色 | 边框 |
|---------|---------|--------|------|
| 2-10    | 30px    | `#67C23A` | 2px 白边 |
| 11-50   | 36px    | `#85CE61` | 2px 白边 |
| 51-200  | 42px    | `#E6A23C` | 2px 白边 |
| 201-1000| 48px    | `#F56C6C` | 3px 白边 |
| > 1000  | 54px    | `#909399` | 3px 白边 |

#### 聚合图标样式

- 圆形背景 + 数量文字居中
- 文字颜色：白色，字号根据数字位数自适应
- 添加轻微阴影：`0 2px 8px rgba(0,0,0,0.15)`
- Hover 效果：放大 1.15 倍 + 阴影增强

### 4.3 高亮效果

- 地图：Selected 点位突出显示
- 表格：选中行背景色 `rgba(64, 158, 255, 0.1)`

### 4.4 Info Window 设计

- 圆角卡片样式：border-radius 8px
- 阴影：`0 4px 16px rgba(0,0,0,0.12)`
- 底部小三角指向点位
- 关闭按钮：右上角 ×
- 最大宽度：280px

---

## 五、边界情况处理

### 5.1 空数据状态

- Map 无数据：显示空状态插图 + "暂无地点数据"
- Table 无数据：显示空表格占位

### 5.2 加载状态

- 地图加载中：显示加载动画覆盖层

### 5.3 异常处理

- 坐标无效：跳过该点位，控制台警告

---

## 六、性能优化

### 6.2 交互防抖

- 拖拽分隔条：resize 事件 throttle 16ms
- 地图缩放：zoom 事件 debounce 150ms
- 表格行点击：click 事件 debounce 200ms

### 6.3 缓存策略

- 布局比例存入 localStorage
- 上次选中状态可选持久化

### 

地图不能频繁创建，避免too many WebGL context 


## 参考：
百度地图
GL API：https://lbsyun.baidu.com/index.php?title=jspopularGL
GL 类参考：https://mapopen-pub-jsapi.bj.bcebos.com/jsapi/reference/jsapi_webgl_1_0.html
开源库：https://github.com/huiyan-fe/BMapGLLib
mapvdata：https://lbsyun.baidu.com/solutions/mapvdata
V3.0 API：https://lbs.baidu.com/index.php?title=jspopular3.0